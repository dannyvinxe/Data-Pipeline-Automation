import os
import pandas as pd

def read_data(file_path):
    ext = os.path.splitext(file_path)[-1].lower()
    print(f"Reading data from {file_path}...")
    if ext == '.csv':
        return pd.read_csv(file_path)
    elif ext == '.xlsx':
        return pd.read_excel(file_path)
    elif ext == '.json':
        return pd.read_json(file_path, lines=True)
    else:
        raise ValueError(f"Unsupported file format: {ext}")

def process_data(df):
    print(f"Processing data... Number of rows before processing: {len(df)}")
    df_cleaned = df.dropna().reset_index(drop=True)
    print(f"Number of rows after processing: {len(df_cleaned)}")
    return df_cleaned

def write_data(df, output_path):
    # Ensure the directory exists
    os.makedirs(os.path.dirname(output_path), exist_ok=True)
    df.to_csv(output_path, index=False)
    print(f"Processed data written to {output_path}")

def data_pipeline(input_path, output_path):
    print("Starting data pipeline...")
    df = read_data(input_path)
    df_processed = process_data(df)
    write_data(df_processed, output_path)
    print(f"Data pipeline completed. Processed data saved to {output_path}")

if __name__ == "__main__":
    input_file = 'data/input_file.csv'  # Change this to your input file path if needed
    output_file = 'data/output_file.csv'  # Change this to your output file path if needed
    data_pipeline(input_file, output_file)
